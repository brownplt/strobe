<html>
<head>

<script type="text/javascript" src="prototype.js"></script>
<script type="text/javascript" src="data/jstrace.js"></script>

<title>JSTrace test</title>

<script type="text/javascript">
function pln(s) {
   s = s || "";
   var p = document.createTextNode(s);
   var rezdiv = document.getElementById("rezdiv");
   rezdiv.appendChild(p);
   rezdiv.appendChild(document.createElement('br'));
}

var takeUnumbool = __typedjs(
  "takeUnumbool",
  function (arg, arg2) {
    if (arg2) return 9999;
    if (typeof arg == "object")
      return -666;
    if (typeof arg == "number")
      return arg;
    if (arg) return 100;
    return 50;
  });

var strproc1 = __typedjs("strproc1", function (s) { return s+"X"; });
var strproc2 = __typedjs("strproc2", function (o) { return o+"Y"; });
var idd = __typedjs("idd", function (o) { return o; });

var symnum = 1;
var gensym = function(name) {
  if (name) {
    return "" + name + (symnum++);
  }
  return "debug" + (symnum++);
}

var genDebug = function (name) { return __typedjs(gensym(name), function (o) { return; }); };

var procStr = __typedjs(
  "procStr",
  function (s, strproc) {
    return strproc(s);
  });

function loader() {
  setTimeout(useFunction, 600);
}

function Point(x, y) {
  this.x = x;
  this.y = y;
  this.magnitude = __typedjs("Point.magnitude", function () { return this.x + this.y; });
  this.getXfactor = __typedjs("Point.getXfactor", function(f) { return this.x*f; });
}
Point = __typedjs("Point", Point);
//Point.prototype.magnitude = function () { return this.x + this.y; };


function useFunction() {
  pln(takeUnumbool(10));
  pln(takeUnumbool(10));
  pln(takeUnumbool(false));
  pln(takeUnumbool(true));
  pln(takeUnumbool(-5));
  pln(takeUnumbool({x:20}));
  pln(takeUnumbool({x:'fa'}));

  pln(procStr("Hey", strproc1));
  pln(procStr(5, strproc2));

  idd(3);
  idd("HEHEH");

  //recObj.recElement.recElement.recElement.recElement.y = 10;
  var recObj = {};
  recObj.recElement = recObj;
  __typedjs("takesRecObj", function (s) { return; })(recObj);

  var x = __typedjs("x", function (s) { return 1; })
  var y = __typedjs("y", function (s) { return true; })
  var z = __typedjs("z", function (s) { return "hy"; })
  x(y);
  y(z);
  z(x);

  var p = new Point(100, 200);
  pln(p.magnitude());
  pln(p.getXfactor(2));
  pln(p.getXfactor(4.2));
}

</script>
</head>

<body id="body" onload="loader()">
<div id="rezdiv"></div>
</body>

</html>
